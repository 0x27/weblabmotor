<html>

<head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="http://code.highcharts.com/highcharts.js"></script>
        <script src="http://code.highcharts.com/modules/exporting.js"></script>
        <script src="http://code.highcharts.com/modules/data.js"></script>
        <script src="../libs/export-csv/export-csv.js"></script>
        
</head>

<body>
<script src="http://code.highcharts.com/highcharts.js"></script>

   <script type="text/javascript">

	function filter(from, to) {
	    var options = {
	        chart: {
	            renderTo: 'container',
	            type: 'line',
	            width:800,
	            height: 450
	        },
	        title: {
	            text: 'Cabadbaran, Agusan del Norte'
	        },
	        subtitle: {
	            text: 'Source:CSU Phil-LiDAR 1',
	            x: -20
	        },
	        xAxis: {
	            categories: [],
	            minTickInterval: 10,
	            TickInterval: 10,
	            tickmarkPlacement: "on",
	            labels: {
	                padding: 5,
	                align: "center",
	                style: {
	                    fontSize: "10px"
	                }
	            }
	        },
	        yAxis: [{ //primary y axis	
	            min: 0,
	            max: 50,
	            title: {
	                text: "Rainfall Intensity, mm/hr."
	            },
	            reversed: !0,
	            plotLines: [{
	                value: 0,
	                width: 1,
	                color: "#808080"
	            }],
	            plotBands: [{
	                color: '#86e3e7',
	                from: 0,
	                to: 2.5,
	                label: {
	                    text: 'Light',
	                    align: 'left',
	                    x: 10
	                }
	            }, {
	                color: '#8aa7fd',
	                from: 2.5,
	                to: 7.5,
	                label: {
	                    text: 'Moderate',
	                    align: 'left',
	                    x: 10
	                }
	            }, {
	                color: '#8686dc',
	                from: 7.5,
	                to: 15,
	                label: {
	                    text: 'Heavy',
	                    align: 'left',
	                    x: 10
	                }
	            }, {
	                color: '#fed88d',
	                from: 15,
	                to: 30,
	                label: {
	                    text: 'Intense',
	                    align: 'left',
	                    x: 10
	                }
	            }, {
	                color: '#fe9686',
	                from: 30,
	                to: 100,
	                label: {
	                    text: 'Torrential',
	                    align: 'left',
	                    x: 10
	                }
	            }

	            ]
	        }, { //secondary y axis 
	            max: 10,
	            min: 0,
	            title: {
	                text: "Accumulated Rainfall, mm"
	            },
	            plotLines: [{
	                value: 0,
	                width: 1,
	                color: "#808080"
	            }],
	            opposite: !0,
	            reversed: !1
	        }],
	        gridLineDashStyle: 'solid',
	        series: []
	    };
	    $.get('./data.csv', function (data) {
	        var lines = data.split('\n');
	        console.log(lines.length);

	        options.series.push({
	            name: "Rainfall Intensity",
	            data: [],
	            tooltip: {
	                valueSuffix: "  mm/hr."
	            },
	            color: "#0000ff"
	        }, {
	            name: "Accumulated Rainfall",
	            data: [],
	            tooltip: {
	                valueSuffix: " mm"
	            },
	            yAxis: 1,
	            color: "#ff0000"
	        });

	        $.each(lines, function (lineNo, line) {
	            var items = line.split(',');
	            if (lineNo >= from && lineNo <= to) {
	                $.each(items, function (itemNo, item) {
	                    if (itemNo === 0) {
	                        options.xAxis.categories.push(item);
	                    } else if (itemNo === 1) {
	                        options.series[0].data.push(parseFloat(item));
	                    } else if (itemNo === 3) {
	                        options.series[1].data.push(parseFloat(item));
	                    }
	                });
	            }
	        });
	        var chart = new Highcharts.Chart(options);
	    });
	}

	$('#show_chart').click(function () {
	    var from = $('select#from').val();
	    var to = $('select#to').val();
	    if (from < to){
	        filter(from, to);
	    }else{
	        alert('Date From value should be less than to Date To value!');
	    }
	});

	$(window).load(function () {
	var total_amnt = 0;
	var total_amnt1 = 0;    $.get('./data.csv', function (data) {
	        var lines = data.split('\n');
	        var max = lines.length;
	        $.each(lines, function (lineNo, line) {
	            var items = line.split(',');
	            if (lineNo > 0){
	            $.each(items, function (itemNo, item) {
	                if (itemNo === 0) {
	                    var dates = item;
	                    $('select#from').append("<option value='" + lineNo + "'>" + dates + "</option>");
	                    $('select#to').append("<option value='" + lineNo + "'>" + dates + "</option>");
	                }
	                 else if (itemNo === 2) {
	                        var amnt = parseFloat(item);
	                        total_amnt += amnt;
	                     console.log(total_amnt);
	                     //alert(total_amnt);
	                        $('p#total_rainfall_cap').html("Total Rainfall Intensity: <b>" +total_amnt+" mm.</b>");
	                    }
	                else if (itemNo === 3) {
	                        var amnt = parseFloat(item);
	                        total_amnt1 += amnt;
	                     console.log(total_amnt);
	                     //alert(total_amnt);
	                        $('p#total_rainfall_acc').html("Total Accumulated Rainfall: <b>" +total_amnt1+" mm.</b>");
	                    }

	            });
	        }
	        });
	        filter(1, max);
	    });

	});

    </script>



<form class="form-inline text-center">
    <div class="form-group">
        <label for="from">From</label>
        <select class="form-control" id="from">
            <option value="">Select Date Range</option>
        </select>
    </div>
    <div class="form-group">
        <label for="to">To</label>
        <select class="form-control" id="to">
            <option value="">Select Date Range</option>
        </select>
    </div>
    <button type="button" class="btn btn-primary" id="show_chart">Show Chart</button>
</form>
<div id="container" style="width: 800px; height: 500px; margin: 0 auto"></div>

<p id="total_rainfall_cap"></p>
<p id="total_rainfall_acc"></p>


</body>


</html>

