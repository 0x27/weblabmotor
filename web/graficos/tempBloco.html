<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script src="http://code.highcharts.com/highcharts.js"></script>
        <script src="http://code.highcharts.com/modules/exporting.js"></script>
        <script src="./libs/export-csv/export-csv.js"></script>

        <script type="text/javascript">

            var chart;

            $(document).ready(function() {

                chart = new Highcharts.Chart({
                    chart: {
                        renderTo: 'container',
                        type: 'line',
                        zoomType: 'xy', 
                        events: {
                            load: requestData
                        }
                    },
                    title: {
                        text: 'Gráfico de temperaturas',
                        x: -20 //center
                    },
                    subtitle: {
                        text: 'Temperaturas do motor',
                        x: -20
                    },
                    exporting: {
                        enabled: true
                    },
                    xAxis: {
                        title: {
                            text: 'Data'
                        },
                        categories: []
                    },
                    yAxis: {
                        title: {
                            text: '°C'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'top',
                        x: -10,
                        y: 100,
                        borderWidth: 0
                    },
                    series: []
                });
            });

            function requestData() {    
              $.ajax({
                  url: '/cgi-bin/python/database-reader.py?bd=/tmp/weblabmotor/temp.db',
                  type: "GET",
                  dataType: "json",
                  success: function(data) {
                     
                     chart.xAxis[0].setCategories(data[0].DATA);

                      chart.addSeries({
                        name: "a0",
                        data: data[1].A0,
                      });

                      chart.addSeries({
                        name: "a1",
                        data: data[2].A1,
                      });

                  },
                  cache: false
              });
            }

            function updateData() {    
              $.ajax({
                  url: '/cgi-bin/python/database-reader.py?bd=/tmp/weblabmotor/temp.db',
                  type: "GET",
                  dataType: "json",
                  success: function(data) {
                     
                     chart.xAxis[0].setCategories(data[0].DATA);

                      chart.series[0].update({
                        pointStart: data[1].pointStart,
			    		data: data[1].A0
                      }, true);

                      chart.series[1].update({
                        pointStart: data[2].pointStart,
			    		data: data[2].A1
                      }, true);

                  },
                  cache: false
              });
            }
            

        </script>

    </head>
    <body>
        <input type="button" value="Atualizar" onclick="updateData()">

        <iframe name="nada" style="display:none;"></iframe>
        <form action="/cgi-bin/python/database-transfer.py?bdOrigem=/tmp/weblabmotor/temp.db&bdAlvo=/var/lib/weblabmotor/sensores.db" method="post" target="nada">
		<input type="submit" value="Gravar" /><br>
        </form>

        <form action="/cgi-bin/python/database-reset.py?bd=/tmp/weblabmotor/temp.db" method="post" target="nada">
		<input type="submit" value="Apagar" /><br>
        </form>

        <div id="container" style="min-width: 400px; height: 400px; margin: 0 auto">
        </div>    
    </body>
</html>